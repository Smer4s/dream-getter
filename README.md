# Dream Getter (Backend)

# Техническое задание: Приложение для управления событиями

## 1. Введение

**Цель проекта:**  
Создать многопользовательскую платформу, позволяющую пользователям создавать, обновлять и управлять событиями, а также уведомлять подписчиков о появлении новых или измененных событий.

**Основная идея:**  
При создании или изменении события пользователем автоматом рассылается уведомление всем его подписчикам. Для реализации этой функциональности используются микросервисы, обеспечивающие масштабируемость и отказоустойчивость, с коммуникацией через MassTransit (асинхронно) и gRPC (синхронно).

---

## 2. Архитектура системы

### 2.1. Микросервисная архитектура
Приложение состоит из следующих сервисов:

- **User Service (Сервис Пользователей):**  
  - Регистрация, аутентификация, управление профилем.
  - Управление подписками (подписка/отписка), хранение списка подписчиков.

- **Event Service (Сервис Событий):**  
  - Создание, обновление, удаление и хранение событий.
  - Ведение истории изменений (аудит) для каждого события.

- **Notification Service (Сервис Уведомлений):**  
  - Получение сообщений об изменениях событий.
  - Формирование и рассылка уведомлений (email, push, внутренняя нотификация) подписчикам.

- **API Gateway:**  
  - Единая точка входа для клиентских приложений (веб, мобильные).
  - Маршрутизация запросов к соответствующим микросервисам и обеспечение авторизации.

### 2.2. Коммуникация между микросервисами

- **MassTransit:**  
  Используется для асинхронного обмена сообщениями. Например, при создании события Event Service публикует сообщение, которое асинхронно обрабатывается Notification Service для рассылки уведомлений.

- **gRPC:**  
  Применяется для синхронного взаимодействия между сервисами, когда требуется быстрый отклик или запрос данных (например, запрос информации пользователя).

- **Брокер сообщений:**  
  RabbitMQ (или аналогичный брокер) для гарантированной доставки сообщений, масштабируемости и обработки пиковых нагрузок.

---

## 3. Функциональные требования

### 3.1. Пользовательский интерфейс (Frontend)
- Регистрация, аутентификация и авторизация пользователей (поддержка OAuth2/JWT).
- Просмотр и редактирование личного профиля.
- Лента событий с возможностью фильтрации (недавние, популярные и др.).
- Получение уведомлений о новых или изменённых событиях от пользователей, на которых подписан текущий пользователь.

### 3.2. Сервис Пользователей (User Service)
- Реализация регистрации, авторизации, восстановления пароля.
- Управление профилем пользователя (просмотр и редактирование информации).
- Обработка подписок и отписок:
  - Возможность подписки на другого пользователя для получения уведомлений о его событиях.
  - Отображение списка подписчиков и подписок.

### 3.3. Сервис Событий (Event Service)
- **Создание события:**
  - Ввод названия, описания, даты и времени, места проведения.
  - Дополнительные параметры: категория, настройка приватности (публичное/приватное событие).
- **Обновление/удаление события:**
  - Доступно только автору события.
- **Хранение истории изменений:**
  - Логирование всех операций для возможности аудита.

### 3.4. Сервис Уведомлений (Notification Service)
- Подписка на сообщения от Event Service через MassTransit.
- Формирование уведомления для каждого подписчика:
  - Возможность отправки уведомлений через email, push или внутреннюю систему нотификаций.
- Управление статусами уведомлений (прочитано/не прочитано).

### 3.5. API Gateway
- Единая точка входа для всех клиентских запросов.
- Маршрутизация запросов к соответствующим микросервисам.
- Обеспечение безопасности (аутентификация и авторизация) для всех входящих запросов.

---

## 4. Нефункциональные требования

- **Масштабируемость:**  
  Горизонтальное масштабирование каждого микросервиса, использование Docker для контейнеризации и Kubernetes для оркестрации.

- **Надёжность и отказоустойчивость:**  
  Реализация повторных попыток доставки сообщений, обработка ошибок, централизованное логирование и мониторинг.

- **Производительность:**  
  Минимизация задержек между сервисами за счёт использования gRPC для синхронных запросов и MassTransit для событий в реальном времени.

- **Безопасность:**  
  Использование современных протоколов (OAuth2, JWT) для авторизации и аутентификации, шифрование данных, защита API от несанкционированного доступа.

- **Логирование и мониторинг:**  
  Централизованное логирование (например, через ELK Stack) и мониторинг системы (Prometheus, Grafana).

---

## 5. Технологический стек

- **Язык:** C#
- **Платформа:** ASP.NET Core
- **Обмен сообщениями:**  
  - MassTransit для асинхронной коммуникации.
  - Broker: RabbitMQ (или аналогичный брокер сообщений).
- **Синхронная коммуникация:** gRPC
- **База данных:**  
  Реляционные СУБД (PostgreSQL, SQL Server) для основной информации, возможное использование NoSQL (например, MongoDB) для логов или кэширования.
- **Контейнеризация:** Docker
- **Оркестрация:** Kubernetes (или Docker Swarm)
- **Мониторинг и логирование:** Prometheus, Grafana, ELK Stack

---

## 6. Основные сценарии использования

1. **Регистрация и настройка профиля пользователя:**
   - Пользователь регистрируется в системе, заполняет профиль и настраивает параметры уведомлений.
   - Отображаются подписки и подписчики пользователя.

2. **Создание события:**
   - Пользователь создаёт событие через веб или мобильное приложение.
   - Event Service сохраняет данные события и публикует соответствующее сообщение через MassTransit.

3. **Уведомление подписчиков:**
   - Notification Service получает сообщение о новом событии.
   - Формируются уведомления для каждого подписчика и отправляются через выбранный канал связи.

4. **Обновление и удаление события:**
   - Автор события имеет возможность редактировать или удалять своё событие.
   - Изменения фиксируются в истории, а подписчикам рассылаются обновленные уведомления.

---

## 7. Тестирование и контроль качества

- **Юнит-тестирование:**  
  Покрытие основных компонентов бизнес-логики и API.

- **Интеграционное тестирование:**  
  Проверка взаимодействия между микросервисами (MassTransit, gRPC, API Gateway).

- **Нагрузочное тестирование:**  
  Оценка производительности системы при большом потоке уведомлений и одновременных запросах.

- **Тестирование безопасности:**  
  Аудит безопасности, тестирование API на предмет уязвимостей.

---

## 8. План разработки

1. **Анализ и проектирование:**
   - Обзор требований и построение архитектурной схемы.
  
2. **Разработка прототипа (MVP):**
   - Минимальный набор функций: регистрация, создание события, уведомление подписчиков.

3. **Реализация микросервисов:**
   - Создание каждого сервиса по отдельности с последующей интеграцией через API Gateway и брокер сообщений.

4. **Тестирование и отладка:**
   - Проведение юнит-тестов, интеграционных и нагрузочных тестов.

5. **Деплой и мониторинг:**
   - Настройка CI/CD, разворачивание в контейнерах, интеграция с системами мониторинга.

---

## 9. Документация и поддержка

- **API-документация:**  
  Использование Swagger/OpenAPI для документирования API.

- **Руководство для разработчиков:**  
  Подробное описание архитектуры, инструкции по деплою, настройке MassTransit и gRPC.

- **Кодировочные стандарты:**  
  Описание соглашений по кодированию, логированию и управлению зависимостями.

---

## 10. Заключение

Данное техническое задание описывает основу для разработки масштабируемого, отказоустойчивого и быстродействующего приложения для управления событиями с использованием микросервисной архитектуры на платформе ASP.NET. Асинхронный обмен сообщениями через MassTransit в сочетании с синхронной коммуникацией через gRPC позволит создавать гибкие и высокопроизводительные решения для реального времени.

